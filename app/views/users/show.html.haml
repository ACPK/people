#user.row
  .col-sm-6
    .user-heading
      %h1
        - if user.gravatar?
          = user.gravatar_image class: "img-rounded", alt: user.name
        = user.name
      = mail_to user.email, "send email"
    .list-group
      = simple_form_for user do |f|
        .list-group-item
          = f.input :contract_type_id, collection: contractTypes
        .list-group-item
          = f.input :primary_role_id, collection: roles, label: 'Primary role:'
        .list-group-item
          = f.label :roles_ids, 'Other Roles'
          = f.input :role_ids,
            as: :select,
            collection: roles,
            input_html: { multiple: true, id: 'js-user-roles'},
            label: false
        .list-group-item
          = f.label :ability_ids, 'Skills & technologies'
          = f.input :ability_ids,
            as: :select,
            collection: abilities,
            input_html: { multiple: true, id: 'js-user-abilities'},
            label: false
        .list-group-item
          = f.label :user_notes, 'Notes'
          = f.input :user_notes, as: :text, label: false, input_html: { rows: 5 }
        .list-group-item
          %h4.list-group-item-heading= "Positions"
          .list-group
            - positions.each do |p|
              .row
                .col-sm-12-with-margin
                  = link_to edit_position_path(p), class: 'list-group-item' do
                    %i.fa.fa-calendar
                    = p.starts_at
                    = p.role.label
                  = link_to 'delete', p, method: :delete, data: { confirm: I18n.t('confirm_question') }, class: 'btn btn-xs btn-danger pull-right'
          .actions
            - if current_user.admin? || current_user == user
              = link_to I18n.t('positions.new'), new_position_path(user: user), class: "btn btn-default btn-success"
        .list-group-item
          .row
            .col-sm-12
              = f.input :employment, wrapper: :prepend, label_html: { class: 'input-group-addon' }
        .list-group-item
          = f.input :location_id, collection: locations
        .list-group-item
          = f.input :skype
        .list-group-item
          = f.input :phone
        .list-group-item
          = f.input :archived, as: :boolean
        .list-group-item
          = f.button :submit, class: 'btn-success'

  .col-sm-6
    .panel.panel-default
      .panel-body
        = simple_form_for @membership do |f|
          .row
            .col-sm-6
              = f.input :starts_at, as: :date_picker, wrapper: :prepend, label_html: { class: 'input-group-addon' }
              = f.association :project, collection: sorted_unarchived_projects, include_blank: false
            .col-sm-6
              = f.input :ends_at, as: :date_picker, wrapper: :prepend, label_html: { class: 'input-group-addon' }
              = f.association :role, collection: roles, include_blank: false
            .col-sm-6
              = f.input :billable, as: :boolean, input_html: { checked: user.primary_role.billable? }
            .col-sm-6
              = f.input :booked, as: :boolean
              .hidden= f.input :user_id
          .actions
            = f.button :submit, "Add to project", data: { confirm: I18n.t('confirm_question') }, class: 'btn-success'

    .tabpanel{ role: 'tabpanel' }
      %ul.nav.nav-tabs{ role: 'tablist' }
        %li.active{ role: 'presentation' }
          = link_to 'Unarchived', '#unarchived', html_options = { 'aria-controls'=> 'unarchived', role: 'tab', 'data-toggle'=> 'tab' }
        %li{ role: 'presentation' }
          = link_to 'Archived', '#archived', html_options = { 'aria-controls'=> 'unarchived', role: 'tab', 'data-toggle'=> 'tab' }

    .tab-content
      .tab-pane.active#unarchived{ role: 'tabpanel' }
        .list-group
          - user.unarchived_projects.reverse_each do |project, memberships|
            = render partial: 'projects', locals: { project: project, memberships: memberships }
      .tab-pane#archived{ role: 'tabpanel' }
        .list-group
          - user.archived_projects.reverse_each do |project, memberships|
            = render partial: 'projects', locals: { project: project, memberships: memberships }

  .time-section
    .timeline
    .timeline-buttons
